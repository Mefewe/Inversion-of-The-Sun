on_actions = {
	on_capitulation = {
		effect = {
			set_global_flag = show_peace_popup_alert
			FROM = {
				save_global_event_target_as = winning_country
			}
			ROOT = {
				save_global_event_target_as = losing_country
			}

			log = "[GetDateText]: winner/loser: FROM: [winning_country.GetName] ROOT: [losing_country.GetName] on_capitulation"

			if = {
				limit = {
					event_target:losing_country = {
						any_allied_country = {
							has_war_together_with = event_target:losing_country
						}
					}
				}
				set_global_flag = losing_country_multiple
			}

			if = {
				limit = {
					event_target:winning_country = {
						any_allied_country = {
							has_war_together_with = event_target:winning_country
						}
					}
				}
				set_global_flag = winning_country_multiple
			}
			add_to_variable = { global.peace_popup_dirty = 1 }

			#Annexation block
			#This if block will only fire if FROM (capitulator) and ROOT (country being capitulated)
			#That is to say, if one side has completely lost (nobody left to fight on)

			if = {
				limit = {
					OR = {
						ROOT = { is_in_faction = no }
						ROOT = {
							all_allied_country = {
								has_capitulated = yes				
							}
						}
					}
				}
				log = "[GetDateText]: War Won BAZA"
				set_global_flag = war_won
				if = {
					limit = {		
						FROM ={ original_tag = VKR }
						ROOT = { original_tag = CRY }
					}
					FROM = {
						clr_country_flag = VKR_polevoje_dvizhnije
						annex_country = {
							target = ROOT
							transfer_troops = no
						}
						drop_cosmetic_tag = yes
						######
						914 = {
							reset_state_name = yes
							reset_province_name = 9128
						}
						######
					}
				}
				if = {
					limit = {		
						FROM = { original_tag = EQS }
						ROOT = { original_tag = CHN }	
					}
					set_global_flag = skip_default_capitulation
				}
				#DEFAULT CAPITULATION
				if = {
					limit = { NOT = { has_global_flag = skip_default_capitulation } }
					#Annex every country they've been fighting against
					log = "Default Capitulation"
					FROM = {
						every_enemy_country = {
							limit = {
								OR = {
									original_tag = ROOT
									is_in_faction_with = ROOT
									is_puppet_of = ROOT
								}
							}
							FROM = {
								white_peace = PREV
								annex_country = {
									target = PREV
									transfer_troops = no
								}
							}
						}
					}
				}	
			}
			if = { 
				limit = {
					ROOT = {
						is_puppet = yes
						if = {
							limit = { is_puppet = yes }
							OVERLORD = { has_capitulated = no }
						}
					}
				}
				log = "endded puppet"
				ROOT = { OVERLORD = { end_puppet = PREV } }
			}
			if = {
				limit = {						
					FROM = { original_tag = EQS }
					ROOT = { original_tag = CHN }					
				}
				set_global_flag = war_won
				log = "[GetDateText]: EQS WON WAR WITH CHN"
				FROM = { #Эту хуйню надо переделать позже, пока что это тест но потом будет конкретно реконструкционные правительства и прочая поебота.
					every_enemy_country = {
						limit = {
							OR = {
								original_tag = ROOT
								is_in_faction_with = ROOT
								is_puppet_of = ROOT
							}
						}
						FROM = {
							white_peace = PREV
							annex_country = {
								target = PREV
								transfer_troops = no
							}
						}
					}
				}
			}
			if = { #для войн которые будут продолжаца
				limit = {
					always = no
				}
				set_global_flag = war_continuing
			}
			clr_global_flag = skip_default_capitulation	
		}	
	}
	on_declare_war = {
		effect = {
			log="[GetDateText]: [Root.GetName] declared war on [From.GetName]"
		}
	}
}


##########
on_actions = {
	on_state_control_changed = {
		effect = {
			if = {
				limit = {
					has_global_flag = TAI_UNC_WAR
					TAI = {
						has_war = yes
						controls_state = 699
						controls_state = 716
						controls_state = 717
						controls_state = 735
						controls_state = 815
						controls_state = 754
						controls_state = 684
						controls_state = 710
					}
				}
				UNC = {
					white_peace = TAI
				}
				TAI_won_UNC = yes
				clr_global_flag = TAI_UNC_WAR
				TAI = {
					set_country_flag = TAI_UNC_WAR_SUCC
				}
			}
		}
	}
}