on_actions = {
	on_capitulation = {
		effect = {
			set_global_flag = show_peace_popup_alert
			FROM = {
				save_global_event_target_as = winning_country
			}
			ROOT = {
				save_global_event_target_as = losing_country
			}

			log = "[GetDateText]: winner/loser: FROM: [winning_country.GetName] ROOT: [losing_country.GetName] on_capitulation"

			if = {
				limit = {
					event_target:losing_country = {
						any_allied_country = {
							has_war_together_with = event_target:losing_country
						}
					}
				}
				set_global_flag = losing_country_multiple
			}

			if = {
				limit = {
					event_target:winning_country = {
						any_allied_country = {
							has_war_together_with = event_target:winning_country
						}
					}
				}
				set_global_flag = winning_country_multiple
			}
			add_to_variable = { global.peace_popup_dirty = 1 }

			#Annexation block
			#This if block will only fire if FROM (capitulator) and ROOT (country being capitulated)
			#That is to say, if one side has completely lost (nobody left to fight on)

			if = {
				limit = {
					OR = {
						ROOT = { is_in_faction = no }
						ROOT = {
							all_allied_country = {
								has_capitulated = yes
							}
						}
					}
				}
				log = "war_won"
				set_global_flag = war_won
				if = {
					limit = {		
						FROM ={ original_tag = VKR }
						ROOT = { original_tag = CRY }
					}
					FROM = {
						clr_country_flag = VKR_polevoje_dvizhnije
						annex_country = {
							target = ROOT
							transfer_troops = no
						}
						drop_cosmetic_tag = yes
						######

						######
					}
				}
			}
		}	
	}
}