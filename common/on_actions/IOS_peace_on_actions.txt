on_actions = {
	on_capitulation = {
		effect = {
			set_global_flag = show_peace_popup_alert
			FROM = {
				save_global_event_target_as = winning_country
			}
			ROOT = {
				save_global_event_target_as = losing_country
			}

			log = "[GetDateText]: winner/loser: FROM: [winning_country.GetName] ROOT: [losing_country.GetName] on_capitulation"

			if = {
				limit = {
					event_target:losing_country = {
						any_allied_country = {
							has_war_together_with = event_target:losing_country
						}
					}
				}
				set_global_flag = losing_country_multiple
			}

			if = {
				limit = {
					event_target:winning_country = {
						any_allied_country = {
							has_war_together_with = event_target:winning_country
						}
					}
				}
				set_global_flag = winning_country_multiple
			}
			add_to_variable = { global.peace_popup_dirty = 1 }

			#Annexation block
			#This if block will only fire if FROM (capitulator) and ROOT (country being capitulated)
			#That is to say, if one side has completely lost (nobody left to fight on)

			if = {
				limit = {
					OR = {
						ROOT = { is_in_faction = no }
						ROOT = {
							all_allied_country = {
								has_capitulated = yes				
							}
						}
					}
				}
				log = "[GetDateText]: War Won BAZA"
				set_global_flag = war_won
				if = {
					limit = {		
						FROM ={ original_tag = VKR }
						ROOT = { original_tag = CRY }
					}
					FROM = {
						clr_country_flag = VKR_polevoje_dvizhnije
						annex_country = {
							target = ROOT
							transfer_troops = no
						}
						drop_cosmetic_tag = yes
						######
						914 = {
							reset_state_name = yes
							reset_province_name = 9128
						}
						######
					}
				}
				if = {
					limit = {
						ROOT = { original_tag = OZB }	
					}
					set_global_flag = skip_default_capitulation
				}
				if = {
					limit = {
						ROOT = { original_tag = TYR }	
					}
					set_global_flag = skip_default_capitulation
				}
				if = {
					limit = {
						ROOT = { original_tag = FRZ }	
					}
					set_global_flag = skip_default_capitulation
				}
				if = {
					limit = {		
						FROM = { original_tag = EQS }
						ROOT = { original_tag = CHN }	
					}
					set_global_flag = skip_default_capitulation
				}
				#DEFAULT CAPITULATION
				if = {
					limit = { NOT = { has_global_flag = skip_default_capitulation } }
					#Annex every country they've been fighting against
					log = "Default Capitulation"
					FROM = {
						every_enemy_country = {
							limit = {
								OR = {
									original_tag = ROOT
									is_in_faction_with = ROOT
									is_puppet_of = ROOT
								}
							}
							FROM = {
								white_peace = PREV
								annex_country = {
									target = PREV
									transfer_troops = no
								}
							}
						}
					}
				}	
			}
			if = { 
				limit = {
					ROOT = {
						is_puppet = yes
						if = {
							limit = { is_puppet = yes }
							OVERLORD = { has_capitulated = no }
						}
					}
				}
				log = "endded puppet"
				ROOT = { OVERLORD = { end_puppet = PREV } }
			}
			if = {
				limit = {						
					FROM = { original_tag = EQS }
					ROOT = { original_tag = CHN }					
				}
				set_global_flag = war_won
				log = "[GetDateText]: EQS WON WAR WITH CHN"
				FROM = { #Эту хуйню надо переделать позже, пока что это тест но потом будет конкретно реконструкционные правительства и прочая поебота.
					every_enemy_country = {
						limit = {
							OR = {
								original_tag = ROOT
								is_in_faction_with = ROOT
								is_puppet_of = ROOT
							}
						}
						FROM = {
							white_peace = PREV
							annex_country = {
								target = PREV
								transfer_troops = no
							}
						}
					}
				}
			}
			if = {
				limit = { 
					ROOT = { original_tag = OZB } 
					ROOT = {
						has_war_with = AGA
						has_war_with = AGB
						has_war_with = AGC
					}
				}
				
				log = "[GetDateText]: SUDERN-ZEBRIKA IS DEFEATED"
				set_global_flag = antiozb_war_won

				ROOT = { leave_faction = yes }
				AGA = {
					white_peace = ROOT
					transfer_state = 631
					transfer_state = 630
					transfer_state = 703
					transfer_state = 617
					transfer_state = 332
					transfer_state = 892
					transfer_state = 439
					transfer_state = 618
				}
				if = {
					limit = {
						NOT = {
							DRG = {
								controls_state = 565
							}
						}
					}
					AGA = {
						transfer_state = 565
					}
				}
				if = {
					limit = {
						NOT = {
							DRG = {
								controls_state = 445
							}
						}
					}
					AGA = {
						transfer_state = 445
					}
				}
				AGB = {
					white_peace = ROOT
					transfer_state = 559
					transfer_state = 430
					transfer_state = 290
					transfer_state = 54
				}
				AGC = {
					white_peace = ROOT
					transfer_state = 818
					transfer_state = 838
					transfer_state = 418
					transfer_state = 589
					transfer_state = 841
				}
				AGD = {
					white_peace = ROOT
				}
				if = {
					limit = {
						country_exists = ZGR
						ZGR = {
							has_war_with = ROOT
						}
					}
					ZGR = {
						white_peace = ROOT
					}
				}
			}
			if = {
				limit = { 
					ROOT = { original_tag = TYR }
					ROOT = {
							has_war_with = AGA
							has_war_with = AGB
							has_war_with = AGC
							has_war_with = AGD
					}
				}
				log = "[GetDateText]: TYRLITIA IS DEFEATED"
				set_global_flag = antityr_war_won
				ROOT = { leave_faction = yes }

				AGA = {
					white_peace = ROOT
				}
				AGB = {
					white_peace = ROOT
				}
				AGC = {
					white_peace = ROOT
				}
				AGD = {
					white_peace = ROOT
					transfer_state = 562
					transfer_state = 547
					transfer_state = 567
					transfer_state = 578
					transfer_state = 956
					transfer_state = 571
					transfer_state = 550
					transfer_state = 601
					transfer_state = 608
					transfer_state = 954
					transfer_state = 702
					transfer_state = 711
					transfer_state = 635
					transfer_state = 678
					transfer_state = 612
					transfer_state = 654
				}
				if = {
					limit = {
						country_exists = BKS
						BKS = {
							has_war_with = ROOT
						}
					}
					BKS = {
						white_peace = TYR
						transfer_state = 959
						transfer_state = 652
						transfer_state = 712
						transfer_state = 756
						transfer_state = 665
						transfer_state = 802
						transfer_state = 958
						transfer_state = 779
						transfer_state = 957
						transfer_state = 758
					}
				}
				else = {
					AGD = {
						transfer_state = 959
						transfer_state = 652
						transfer_state = 712
						transfer_state = 756
						transfer_state = 665
						transfer_state = 802
						transfer_state = 958
						transfer_state = 779
						transfer_state = 957
						transfer_state = 758
					}
				}
				if = {
					limit = {
						country_exists = SDL
						SDL = {
							has_war_with = ROOT
						}
					}
					SDL = {
						white_peace = TYR
						transfer_state = 961
						transfer_state = 502
						transfer_state = 503
						transfer_state = 505
						transfer_state = 951
						transfer_state = 952
						transfer_state = 468
						transfer_state = 496
						transfer_state = 953
					}
				}
				else = {
					AGD = {
						transfer_state = 961
						transfer_state = 502
						transfer_state = 503
						transfer_state = 505
						transfer_state = 951
						transfer_state = 952
						transfer_state = 468
						transfer_state = 496
						transfer_state = 953
					}
				}
			}
			if = {
				limit = { 
					ROOT = { original_tag = FRZ } 
					ROOT = {
						has_war_with = AGA
						has_war_with = AGB
						has_war_with = AGC
						has_war_with = AGD
					}
				}
				log = "[GetDateText]: FARAZIA IS DEFEATED"
				set_global_flag = antityr_war_won
				FRZ = { leave_faction = yes }
				AGA = {
					white_peace = ROOT
				}
				AGB = {
					white_peace = ROOT
					transfer_state = 908
					transfer_state = 886
					transfer_state = 833
					transfer_state = 787
					transfer_state = 777
					transfer_state = 746
					transfer_state = 690
				}
				AGC = {
					white_peace = ROOT
				}
				AGD = {
					white_peace = ROOT
				}
				if = {
					limit = {
						country_exists = ZRT
						ZRT = {
							has_war_with = ROOT
						}
					}
					ZRT = {
						white_peace = ROOT
						transfer_state = 912
						transfer_state = 887
						transfer_state = 75
						transfer_state = 823
						transfer_state = 884
						transfer_state = 856
					}
				}
				else = {
					AGB = {
						transfer_state = 912
						transfer_state = 887
						transfer_state = 75
						transfer_state = 823
						transfer_state = 884
						transfer_state = 856
					}
				}
				if = {
					limit = {
						country_exists = SDL
						SDL = {
							has_war_with = ROOT
						}
					}
					SDL = {
						white_peace = ROOT
						transfer_state = 855
						transfer_state = 813
						transfer_state = 781
						transfer_state = 745
						transfer_state = 733
						transfer_state = 696
						transfer_state = 629
					}
				}
				else = {
					AGB = {
						transfer_state = 855
						transfer_state = 813
						transfer_state = 781
						transfer_state = 745
						transfer_state = 733
						transfer_state = 696
						transfer_state = 629
					}
				}
			}
			if = { #для войн которые будут продолжаца
				limit = {
					always = no
				}
				set_global_flag = war_continuing
			}
			clr_global_flag = skip_default_capitulation	
		}
	}
}


##########
on_actions = {
	on_state_control_changed = {
		effect = {
			if = {
				limit = {
					has_global_flag = TAI_UNC_WAR
					TAI = {
						has_war = yes
						controls_state = 699
						controls_state = 716
						controls_state = 717
						controls_state = 735
						controls_state = 815
						controls_state = 754
						controls_state = 684
						controls_state = 710
					}
				}
				UNC = {
					white_peace = TAI
				}
				TAI_won_UNC = yes
				clr_global_flag = TAI_UNC_WAR
				TAI = {
					set_country_flag = TAI_UNC_WAR_SUCC
					country_event = TAI.23
				}
			}
		}
	}
}